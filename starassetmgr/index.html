<!DOCTYPE html>
<html>
<head>
    <title>Star Asset Manager</title>
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/olistar0/starproductions/refs/heads/main/assets/tabicon.png">
    <meta name="title" content="Star Productions - Star Asset Manager">
    <meta name="theme-color" content="#ffffff">
    <meta name="description" content="View the details of Roblox Assets and download them!" />
    <style>
        :root {
            --bg-url: url('https://raw.githubusercontent.com/olistar0/starproductions/refs/heads/main/assets/bg.png');
            --logo-url: url('https://raw.githubusercontent.com/olistar0/starproductions/refs/heads/main/starassetmgr/assets/hover.png');
            --glass-bg: rgba(255, 255, 255, 0.18);
            --glass-border: rgba(255, 255, 255, 0.35);
            --glass-shadow: rgba(0, 0, 0, 0.25);
            --glass-blur: blur(22px);
            --glass-radius: 18px;
            --input-bg: rgba(255, 255, 255, 0.22);
            --input-border: rgba(255, 255, 255, 0.45);
            --button-bg: rgba(255, 255, 255, 0.35);
            --button-hover: rgba(255, 255, 255, 0.55);
            --button-active: rgba(255, 255, 255, 0.75);
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--bg-url) no-repeat center center fixed;
            background-size: cover;
            color: #000;
            padding: 40px 20px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 960px;
        }

        .logo {
            height: 200px;
            background-image: var(--logo-url);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 100%;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 12px rgba(255,255,255,0.6));
        }

        .logo-animated {
            animation: floaty 4s ease-in-out infinite;
        }

        @keyframes floaty {
            0% { transform: translateY(0px); }
            50% { transform: translateY(14px); }
            100% { transform: translateY(0px); }
        }

        @keyframes pulseGlow {
            0% {
                box-shadow: 0 4px 18px rgba(255, 184, 77, 0.4);
                transform: translateY(0);
            }
            50% {
                box-shadow: 0 8px 26px rgba(255, 184, 77, 0.85);
                transform: translateY(-2px);
            }
            100% {
                box-shadow: 0 4px 18px rgba(255, 184, 77, 0.4);
                transform: translateY(0);
            }
        }

        @keyframes errorShine {
            0% {
                background-position: -200px 0;
            }
            50% {
                background-position: 200px 0;
            }
            100% {
                background-position: -200px 0;
            }
        }

        label {
            font-weight: bold;
            margin-top: 12px;
            display: block;
            color: #fff;
            text-shadow: 0 0 6px rgba(255,255,255,0.6);
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0 20px 0;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: var(--glass-radius);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            color: #000;
            font-size: 15px;
            box-shadow: 0 4px 14px var(--glass-shadow);
            box-sizing: border-box;
        }

        button {
            padding: 12px 20px;
            width: 100%;
            background: var(--button-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            color: #000;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            box-shadow: 0 4px 18px var(--glass-shadow);
            transition: 0.2s ease;
        }

        button:hover {
            background: var(--button-hover);
            transform: translateY(-2px);
        }

        button:active {
            background: var(--button-active);
            transform: translateY(0px);
        }

        .execute-btn {
            background: linear-gradient(90deg, #ffe08a, #ff9f3f);
            color: #402200;
            box-shadow: 0 4px 18px rgba(255, 184, 77, 0.7);
            animation: pulseGlow 2.6s ease-in-out infinite;
        }

        .execute-btn:hover {
            background: linear-gradient(90deg, #ffe9a8, #ffb25f);
        }

        h3 {
            margin-top: 30px;
            color: #fff;
            text-shadow: 0 0 6px rgba(255,255,255,0.6);
        }

        .glass {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            padding: 18px;
            margin-top: 12px;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            box-shadow: 0 8px 28px var(--glass-shadow);
            color: #000;
            box-sizing: border-box;
            width: 100%;
        }

        .asset-container {
            display: flex;
            gap: 20px;
            align-items: stretch;
            width: 100%;
            box-sizing: border-box;
        }

        .asset-left {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .asset-right {
            flex: 1;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            padding: 18px;
            text-align: center;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            box-shadow: 0 8px 28px var(--glass-shadow);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 12px;
        }

        pre {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            padding: 12px;
            white-space: pre-wrap;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            box-shadow: 0 4px 14px var(--glass-shadow);
            color: #000;
            box-sizing: border-box;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 13px;
            color: #000;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--glass-radius);
            padding: 10px 16px;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            box-shadow: 0 4px 14px var(--glass-shadow);
            width: 100%;
            box-sizing: border-box;
        }

        .similar-divider {
            margin: 10px 0;
            height: 1px;
            background: rgba(255,255,255,0.5);
        }

        .similar-warning {
            font-size: 11px;
            color: #200;
            opacity: 0.9;
            margin-top: 4px;
        }

        .similar-list {
            margin-top: 8px;
            max-height: 180px;
            overflow-y: auto;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px;
            font-size: 13px;
            display: none;
            text-align: left;
        }

        .similar-item-button {
            width: 100%;
            margin-top: 6px;
            padding: 6px 10px;
            border-radius: 10px;
            background: rgba(255,255,255,0.7);
            border: 1px solid rgba(0,0,0,0.08);
            cursor: pointer;
            font-size: 13px;
            text-align: left;
        }

        .similar-item-button:hover {
            background: rgba(255,255,255,0.9);
        }

        .error-box {
            background: linear-gradient(to bottom, rgba(255,120,120,0.85), rgba(150,0,0,0.95));
            border-radius: 14px;
            padding: 14px;
            color: #fff;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 6px 22px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
        }

        .error-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: -200px;
            width: 200px;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0.2), rgba(255,255,255,0.6), rgba(255,255,255,0.2));
            opacity: 0.7;
            animation: errorShine 3.2s linear infinite;
        }

        .error-ok-button {
            margin-top: 10px;
            background: linear-gradient(90deg, #ffb347, #ff5722);
            color: #3a1a00;
            border-radius: 14px;
            padding: 10px 16px;
            font-weight: bold;
            box-shadow: 0 4px 18px rgba(255,120,60,0.7);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border: 1px solid rgba(255,255,255,0.5);
            width: 100%;
        }

        .error-ok-button:hover {
            background: linear-gradient(90deg, #ffc067, #ff6f3a);
        }

        @media (max-width: 768px) {
            .asset-container {
                flex-direction: column;
            }
        }


        #devModePanel {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 220px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--glass-radius);
    padding: 14px;
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    box-shadow: 0 8px 28px var(--glass-shadow);
    color: #000;
    font-size: 14px;
    z-index: 9999;
}
#devModePanel label {
    color: #000;
    text-shadow: none;
    font-weight: bold;
    margin-top: 6px;
}
    </style>
</head>

<body>
<div class="container">

    <div class="logo logo-animated"></div>

    <label>Asset ID:</label>
    <input id="assetIds" placeholder="Enter the Roblox Asset ID (e.g. 123456789 or rbxassetid://123456789)">

    <label>Place ID (ONLY FOR DOWNLOADING ANIMATION/AUDIO):</label>
    <input id="placeId" placeholder="Sometimes not needed but helps for Animation/Audio downloads if it fails.">

    <button class="execute-btn" onclick="lookup()">Execute</button>

    <h3>Asset Info & Downloads</h3>
    <div id="assetInfo" class="glass"></div>

    <h3>Creator Info</h3>
    <div id="creatorInfo" class="glass"></div>

    <div class="footer">
        Â© 2025 Star Productions - Star Asset Manager | Developed By OliStar (Discord: oli_l_w)
    </div>

</div>

<script>
const backend = "https://apistarproductions.jollyoliver734.workers.dev";

function extractId(input) {
    const match = input.match(/\d+/);
    return match ? match[0] : null;
}

function sanitizeFilename(name) {
    return name.replace(/[\\\/:*?"<>|]/g, "_");
}

let executeCooldown = false;
let currentAssetName = null;
let currentAssetType = null;
let autoAttemptFailed = false;
let lastUsedPlaceId = null;

async function fetchThumbnail(assetId) {
    try {
        assetId = extractId(assetId);
        const res = await fetch(`${backend}/thumbnail/${assetId}`);
        const text = await res.text();
        if (!res.ok) return null;
        const data = JSON.parse(text);
        if (!data.data || !data.data[0] || !data.data[0].imageUrl) return null;
        return data.data[0].imageUrl;
    } catch {
        return null;
    }
}

async function lookup() {
    if (executeCooldown) return;

    const assetBox = document.getElementById("assetInfo");
    const creatorBox = document.getElementById("creatorInfo");

    executeCooldown = true;
    autoAttemptFailed = false;
    let remaining = 3;

    const interval = setInterval(() => {
        assetBox.innerHTML = `Loading... (${remaining})`;
        creatorBox.innerHTML = "";
        remaining--;
        if (remaining < 0) {
            clearInterval(interval);
            executeCooldown = false;
            runLookup();
        }
    }, 1000);
}

async function runLookup() {
    const ids = extractId(document.getElementById("assetIds").value.trim());
    const assetBox = document.getElementById("assetInfo");
    const creatorBox = document.getElementById("creatorInfo");

    currentAssetName = null;
    currentAssetType = null;
    creatorBox.innerHTML = "";
    assetBox.innerHTML = "Loading...";

    if (!ids) {
        assetBox.innerHTML = `<div class="glass">Not a valid asset ID. Did you copy it right?</div>`;
        return;
    }

    try {
        const res = await fetch(backend + "/asset", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ids })
        });

        const text = await res.text();

        if (!res.ok) {
            assetBox.innerHTML = `<pre>${text}</pre>`;
            return;
        }

        const data = JSON.parse(text);

        if (!data.data || !data.data[0]) {
            assetBox.innerHTML = `<div class="glass">Not a valid asset ID. Did you copy it right?</div>`;
            return;
        }

        const asset = data.data[0];
        const creator = asset.creator || {};
        const creatorType = creator.type || null;
        const creatorId = creator.targetId || null;

        const typeName = asset.type;
        const assetName = asset.name || "Asset";
        currentAssetName = assetName;
        currentAssetType = typeName;

        let imagePanel = `
            <div style="margin-bottom:10px;">Image assets can be downloaded.</div>
            <button disabled style="background:#ffdddd;color:#660000;padding:8px 12px;border-radius:12px;font-weight:bold;width:100%;">Not Available</button>
        `;

        if (typeName === "Image" || typeName === "Decal") {
            const thumbUrl = await fetchThumbnail(ids);
            if (thumbUrl) {
                imagePanel = `
                    <div style="margin-bottom:10px;">Image assets can be downloaded.</div>
                    <button style="background:rgba(180,255,180,0.8);color:#000;padding:8px 12px;border-radius:12px;font-weight:bold;width:100%;" onclick="window.open('${thumbUrl}', '_blank')">Download</button>
                `;
            }
        }

        let aaPanel;
        if (typeName === "Animation" || typeName === "Audio") {
            aaPanel = `
                <div id="aaPanel" style="margin-top:15px;">
                    <div style="margin-bottom:5px;">Animation/Audios can be downloaded.</div>
                    <button style="background:rgba(180,255,180,0.8);color:#000;padding:8px 12px;border-radius:12px;font-weight:bold;width:100%;margin-top:8px;" onclick="downloadAsset('${ids}', '${typeName}', '${creatorType}', '${creatorId}')">Download</button>
                    <div class="similar-divider"></div>
                    <button style="background:linear-gradient(90deg,#3bbf7c,#f04b4b);color:#000;padding:8px 12px;border-radius:12px;font-weight:bold;width:100%;margin-top:4px;" onclick="getSimilarAssetFallback('${typeName}')">Get Similar Asset</button>
                    <div class="similar-warning">Only use this as a last resort if it can't find your asset. It's possible to give you the wrong asset.</div>
                    <div id="similarList" class="similar-list"></div>
                </div>
            `;
        } else if (typeName === "Image" || typeName === "Decal") {
            aaPanel = `
                <div id="aaPanel" style="margin-top:15px;">
                    <div style="margin-bottom:5px;">Animation/Audios can be downloaded.</div>
                    <button disabled style="background:#ffdddd;color:#660000;padding:8px 12px;border-radius:12px;font-weight:bold;width:100%;margin-top:8px;">Not Available for this asset type.</button>
                </div>
            `;
        } else {
            aaPanel = `
                <div id="aaPanel" style="margin-top:15px;">
                    <div style="margin-bottom:5px;">Animation/Audios can be downloaded.</div>
                    <div style="background:#ffdddd;color:#660000;padding:12px;border-radius:12px;text-align:center;font-weight:bold;">
                        This asset type is not supported for downloading.
                    </div>
                </div>
            `;
        }

        assetBox.innerHTML = `
            <div class="asset-container">
                <div class="asset-left">
                    <div class="glass">Asset Name: ${assetName}</div>
                    <div class="glass">Asset Type: ${typeName}</div>
                    <div class="glass">Asset Moderated: ${asset.isModerated}</div>
                </div>
                <div id="assetRight" class="asset-right">
                    ${imagePanel}
                    ${aaPanel}
                </div>
            </div>
        `;

        if (creatorType === "User") fetchUser(creatorId);
        if (creatorType === "Group") fetchGroup(creatorId);

    } catch (err) {
        assetBox.innerHTML = `<pre>${err}</pre>`;
    }
}

function showAssetRightError(message) {
    const assetRight = document.getElementById("assetRight");
    if (!assetRight) return;

    if (!assetRight.dataset.original) {
        assetRight.dataset.original = assetRight.innerHTML;
    }

    let extraNote = "";

    if (message.includes("Could not resolve a valid Place ID automatically. Try entering a Place ID manually. (If you already have tried with the id consider using the Get Similar Assets.)")) {
        extraNote = `
            <div style="
                margin-top:10px;
                background:rgba(255,255,255,0.15);
                border:1px solid rgba(255,255,255,0.35);
                padding:8px 10px;
                border-radius:10px;
                font-size:12px;
                color:#ffecec;
                backdrop-filter:blur(14px);
                -webkit-backdrop-filter:blur(14px);
                box-shadow:0 4px 12px rgba(0,0,0,0.25);
            ">
                Note. You only need to press download after adding the place ID. No need to press Execute
            </div>
        `;
    }

    assetRight.innerHTML = `
        <div class="error-box">
            ${message}
            ${extraNote}
        </div>
        <button class="error-ok-button" onclick="restoreAssetRight()">OK</button>
    `;
}

function restoreAssetRight() {
    const assetRight = document.getElementById("assetRight");
    if (!assetRight || !assetRight.dataset.original) return;
    assetRight.innerHTML = assetRight.dataset.original;
    delete assetRight.dataset.original;
    const listBox = document.getElementById("similarList");
    if (listBox) listBox.style.display = "none";
}

async function downloadAsset(assetId, assetType, creatorType, creatorId) {
    assetId = extractId(assetId);
const placeInput = document.getElementById("placeId").value.trim();
const disableDownloads = document.getElementById("devDisableDownloads").checked;
const showPlaceId = document.getElementById("devShowPlaceId").checked;

if (showPlaceId) {
    let box = document.getElementById("devPlaceIdBox");
    if (box) box.textContent = "Place ID Used: Waiting for download...";
}

if (disableDownloads && !showPlaceId) {
    showAssetRightError("Download blocked by Dev Mode.");
    return;
}

lastUsedPlaceId = placeInput || "(auto)";

if (disableDownloads && !showPlaceId) {
    showAssetRightError("Download blocked by Dev Mode.");
    return;
}

lastUsedPlaceId = placeInput || "(auto)";
    return;
}
lastUsedPlaceId = placeInput || "(auto)";
    const assetRight = document.getElementById("assetRight");
    const assetBox = document.getElementById("assetInfo");
    const hasManualPlace = !!placeInput;

    try {
        if (assetRight) {
            if (!assetRight.dataset.original) {
                assetRight.dataset.original = assetRight.innerHTML;
            }
            assetRight.innerHTML = `<div style="background:#fff3cd;color:#664d03;padding:12px;border-radius:12px;text-align:center;font-weight:bold;">Loading download... (Its searching)</div>`;
        }

        const res = await fetch(backend + "/delivery", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                assetId,
                placeId: placeInput || null,
                creatorId: creatorId || null,
                creatorType: creatorType || null,
                assetName: currentAssetName || "",
                assetType: assetType || ""
            })
        });

        const text = await res.text();

        if (!res.ok) {
            if (!hasManualPlace) {
                autoAttemptFailed = true;
            } else {
                if (autoAttemptFailed && (assetType === "Animation" || assetType === "Audio")) {
                    const similar = await trySimilarAsset(assetRight, assetType);
                    if (similar) return;
                }
            }

            let errMsg = "Failed to download asset.";
            try {
                const parsed = JSON.parse(text);
                if (parsed.error) errMsg = parsed.error;
            } catch {}
            showAssetRightError(errMsg);
            return;
        }

        const data = JSON.parse(text);
        const fileRes = await fetch(data.location);
        const fileBuffer = await fileRes.arrayBuffer();

        let extension = "";
        if (assetType === "Animation") extension = ".rbxm";
        if (assetType === "Audio") extension = ".ogg";

        const safeName = sanitizeFilename(currentAssetName || assetId.toString());
        const blob = new Blob([fileBuffer], { type: "application/octet-stream" });
        const downloadUrl = URL.createObjectURL(blob);

if (!disableDownloads) {
    const a = document.createElement("a");
    a.href = downloadUrl;
    a.download = safeName + extension;
    a.click();
}

        URL.revokeObjectURL(downloadUrl);

        if (assetRight && assetRight.dataset.original) {
            assetRight.innerHTML = assetRight.dataset.original;
            delete assetRight.dataset.original;
        }

        if (document.getElementById("devShowPlaceId").checked) {
    const assetBox = document.getElementById("assetInfo");
    const infoBlocks = assetBox.querySelector(".asset-left");
    if (infoBlocks && !document.getElementById("devPlaceIdBox")) {
        const div = document.createElement("div");
        div.className = "glass";
        div.id = "devPlaceIdBox";
        div.textContent = "Place ID Used: " + lastUsedPlaceId;
        infoBlocks.appendChild(div);
    }
}

    } catch (err) {
        showAssetRightError("An error occurred while downloading the asset.");
        assetBox.innerHTML = `<pre>${err}</pre>`;
    }

    if (document.getElementById("devShowPlaceId").checked) {
    const box = document.getElementById("devPlaceIdBox");
    if (box) box.textContent = "Place ID Used: " + lastUsedPlaceId;
}
}

async function trySimilarAsset(assetRight, assetType) {
    try {
        if (!currentAssetName || !assetType) return false;

        if (assetRight) {
            if (!assetRight.dataset.original) {
                assetRight.dataset.original = assetRight.innerHTML;
            }
            assetRight.innerHTML = `<div style="background:#fff3cd;color:#664d03;padding:12px;border-radius:12px;text-align:center;font-weight:bold;">As a last resort we detected a similar named asset in our database. This could be what you're looking for...</div>`;
        }

        const res = await fetch(backend + "/get-similar-assets", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                name: currentAssetName,
                type: assetType
            })
        });

        const text = await res.text();

        if (!res.ok) {
            if (assetRight && assetRight.dataset.original) {
                assetRight.innerHTML = assetRight.dataset.original;
                delete assetRight.dataset.original;
            }
            return false;
        }

        const data = JSON.parse(text);
        const assets = data.assets || [];
        if (!assets.length) {
            if (assetRight && assetRight.dataset.original) {
                assetRight.innerHTML = assetRight.dataset.original;
                delete assetRight.dataset.original;
            }
            return false;
        }

        const first = assets[0];
        const ok = await downloadSpecificSimilar(first.assetId, first.placeId, assetType, true);

        if (assetRight && assetRight.dataset.original) {
            assetRight.innerHTML = assetRight.dataset.original;
            delete assetRight.dataset.original;
        }

        return ok;
    } catch {
        if (assetRight && assetRight.dataset.original) {
            assetRight.innerHTML = assetRight.dataset.original;
            delete assetRight.dataset.original;
        }
        return false;
    }
}

async function getSimilarAssetFallback(assetType) {
    const listBox = document.getElementById("similarList");
    if (!currentAssetName || !assetType || !listBox) return;

    listBox.style.display = "block";
    listBox.innerHTML = `<div>Searching for similar assets...</div>`;

    try {
        const res = await fetch(backend + "/get-similar-assets", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                name: currentAssetName,
                type: assetType
            })
        });

        const text = await res.text();

        if (!res.ok) {
            listBox.innerHTML = `<div>No similar assets found.</div>`;
            return;
        }

        const data = JSON.parse(text);
        const assets = data.assets || [];

        if (!assets.length) {
            listBox.innerHTML = `<div>No similar assets found.</div>`;
            return;
        }

        listBox.innerHTML = `<div>We found ${assets.length} similar asset(s). Click one to download it:</div>`;

        assets.forEach((entry, index) => {
            const btn = document.createElement("button");
            btn.className = "similar-item-button";
            btn.textContent = `#${index + 1} - Asset ID: ${entry.assetId}`;
            btn.onclick = () => downloadSpecificSimilar(entry.assetId, entry.placeId, assetType, false);
            listBox.appendChild(btn);
        });
    } catch {
        listBox.innerHTML = `<div>Error loading similar assets.</div>`;
    }
}

async function downloadSpecificSimilar(assetId, placeId, assetType, silent) {
    const assetRight = document.getElementById("assetRight");

    try {
        if (assetRight) {
            if (!assetRight.dataset.original) {
                assetRight.dataset.original = assetRight.innerHTML;
            }
            if (!silent) {
                assetRight.innerHTML = `<div style="background:#fff3cd;color:#664d03;padding:12px;border-radius:12px;text-align:center;font-weight:bold;">Downloading similar asset...</div>`;
            }
        }

        const res = await fetch(backend + "/delivery", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                assetId: assetId,
                placeId: placeId,
                creatorId: null,
                creatorType: null,
                assetName: currentAssetName || "",
                assetType: assetType || ""
            })
        });

        const text = await res.text();
        if (!res.ok) {
            if (!silent) {
                let errMsg = "Failed to download similar asset.";
                try {
                    const parsed = JSON.parse(text);
                    if (parsed.error) errMsg = parsed.error;
                } catch {}
                showAssetRightError(errMsg);
            }
            return false;
        }

        const data = JSON.parse(text);
        if (!data.location) {
            if (!silent) {
                showAssetRightError("AssetDelivery did not return a location for this Place ID.");
            }
            return false;
        }

        const fileRes = await fetch(data.location);
        const fileBuffer = await fileRes.arrayBuffer();

        let extension = "";
        if (assetType === "Animation") extension = ".rbxm";
        if (assetType === "Audio") extension = ".ogg";

        const safeName = sanitizeFilename(currentAssetName || assetId.toString());
        const blob = new Blob([fileBuffer], { type: "application/octet-stream" });
        const downloadUrl = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = downloadUrl;
        a.download = safeName + extension;
        a.click();

        URL.revokeObjectURL(downloadUrl);

        if (!silent && assetRight && assetRight.dataset.original) {
            assetRight.innerHTML = assetRight.dataset.original;
            delete assetRight.dataset.original;
        }

        return true;
    } catch {
        if (!silent) {
            showAssetRightError("An error occurred while downloading the similar asset.");
        }
        return false;
    }
}

async function fetchUser(userId) {
    const creatorBox = document.getElementById("creatorInfo");

    try {
        const res = await fetch(`${backend}/user/${userId}`);
        const text = await res.text();

        if (!res.ok) {
            creatorBox.innerHTML = `<pre>${text}</pre>`;
            return;
        }

        const user = JSON.parse(text);

        creatorBox.innerHTML = `
            <div class="glass">Creator Type: User</div>
            <div class="glass">Username: ${user.name}</div>
            <div class="glass">Display Name: ${user.displayName}</div>
            <div class="glass">Verified Status: ${user.hasVerifiedBadge}</div>
            <div class="glass">Banned Status: ${user.isBanned}</div>
        `;
    } catch (err) {
        creatorBox.innerHTML = `<pre>${err}</pre>`;
    }
}

async function fetchGroup(groupId) {
    const creatorBox = document.getElementById("creatorInfo");

    try {
        const res = await fetch(`${backend}/group/${groupId}`);
        const text = await res.text();

        if (!res.ok) {
            creatorBox.innerHTML = `<pre>${text}</pre>`;
            return;
        }

        const group = JSON.parse(text);

        creatorBox.innerHTML = `
            <div class="glass">Creator Type: Group</div>
            <div class="glass">Name: ${group.name}</div>
            <div class="glass">Verified Status: ${group.hasVerifiedBadge}</div>
            <div class="glass">Owner's Username: ${group.owner.username}</div>
            <div class="glass">Owner's Display Name: ${group.owner.displayName}</div>
            <div class="glass">Owner's Verified Status: ${group.owner.hasVerifiedBadge}</div>
        `;
    } catch (err) {
        creatorBox.innerHTML = `<pre>${err}</pre>`;
    }
}
    document.getElementById("devShowPlaceId").addEventListener("change", () => {
    const box = document.getElementById("devPlaceIdBox");
    const checked = document.getElementById("devShowPlaceId").checked;

    if (checked) {
        if (!box) {
            const assetBox = document.getElementById("assetInfo");
            const infoBlocks = assetBox.querySelector(".asset-left");
            if (infoBlocks) {
                const div = document.createElement("div");
                div.className = "glass";
                div.id = "devPlaceIdBox";
                div.textContent = "Place ID Used: Waiting for download...";
                infoBlocks.appendChild(div);
            }
        } else {
            box.textContent = "Place ID Used: Waiting for download...";
        }
    } else {
        if (box) box.remove();
    }
});
</script>
<div id="devModePanel" class="glass">
    <div style="font-weight:bold;margin-bottom:6px;">Dev Mode</div>
    <label><input type="checkbox" id="devDisableDownloads"> Disable Downloads</label>
    <label><input type="checkbox" id="devShowPlaceId" checked> Show Place ID Used</label>
</div>
</body>
</html>
